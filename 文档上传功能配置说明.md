# 文档上传功能配置说明

## 功能说明

本项目支持上传文档并自动提取文本内容，支持以下格式：
- `.txt` - 文本文件（原生支持）
- `.docx` - Word 2007+ 文档（原生支持）
- `.doc` - Word 97-2003 文档（需要 Gemini API）
- `.pdf` - PDF 文档（需要 Gemini API）
- `.jpg/.png` 等图片 - OCR 识别（需要 Gemini API）

## 配置方法

### 方式一：使用中转 API（推荐）

如果你已经有中转 API 的访问权限，在 `.env` 文件中配置：

```env
# Gemini API Configuration
VITE_GEMINI_API_KEY=你的API密钥
VITE_GEMINI_API_URL=https://for.shuo.bar/v1beta
VITE_GEMINI_MODEL=gemini-2.0-flash
VITE_ENABLE_GEMINI_DOCUMENT_PROCESSING=true
```

### 方式二：使用官方 Google API

1. **获取 API Key**
   - 访问 https://aistudio.google.com/app/apikey
   - 登录 Google 账号
   - 点击 "Create API Key"
   - 复制生成的 API Key

2. **配置环境变量**

在 `.env` 文件中配置：

```env
# Gemini API Configuration
VITE_GEMINI_API_KEY=你的Google_API_Key
VITE_GEMINI_API_URL=https://generativelanguage.googleapis.com/v1beta
VITE_GEMINI_MODEL=gemini-2.0-flash
VITE_ENABLE_GEMINI_DOCUMENT_PROCESSING=true
```

### 方式三：禁用文档上传功能

如果不需要文档上传功能，只使用文本输入：

```env
VITE_ENABLE_GEMINI_DOCUMENT_PROCESSING=false
```

## 功能对比

| 文件类型 | 原生支持 | Gemini API |
|---------|---------|-----------|
| .txt | ✅ | - |
| .docx | ✅ | ✅ 更好的格式识别 |
| .doc | ❌ | ✅ 必需 |
| .pdf | ❌ | ✅ 必需 |
| 图片 OCR | ❌ | ✅ 必需 |
| 表格识别 | ❌ | ✅ 必需 |

## 使用说明

1. **启动应用**
   ```bash
   npm run dev
   ```

2. **上传文档**
   - 点击"文档上传"标签
   - 选择或拖拽文件
   - 等待文本提取完成
   - 提取的文本会自动填充到输入框

3. **开始改写**
   - 选择改写模式
   - 点击"开始改写"
   - 查看改写结果

## 故障排查

### 问题 1: "Gemini API Key未配置"

**原因**: 环境变量未正确设置

**解决方案**:
1. 检查 `.env` 文件中的 `VITE_GEMINI_API_KEY` 是否已填写
2. 确保 API Key 正确无误
3. 重启开发服务器 (`npm run dev`)

### 问题 2: "Failed to fetch"

**原因**: 网络连接问题或 API 地址错误

**解决方案**:
1. 检查网络连接
2. 确认 `VITE_GEMINI_API_URL` 配置正确
3. 如果使用中转 API，确认中转服务可用
4. 如果使用官方 API，确认可以访问 Google 服务

### 问题 3: ".doc 文件处理失败"

**原因**: .doc 格式必须使用 Gemini API

**解决方案**:
1. 配置 Gemini API Key
2. 或将 .doc 文件转换为 .docx 格式
3. 或直接复制文本内容粘贴

### 问题 4: "文件大小超过限制"

**原因**: Gemini API 限制单个文件最大 20MB

**解决方案**:
1. 压缩文件大小
2. 分割大文件
3. 或直接复制文本内容粘贴

## API 配置对比

### 中转 API
- **优点**: 国内访问速度快，无需科学上网
- **缺点**: 需要有中转服务的访问权限
- **配置**: `VITE_GEMINI_API_URL=https://for.shuo.bar/v1beta`

### 官方 API
- **优点**: 官方支持，稳定可靠
- **缺点**: 国内访问可能需要科学上网
- **配置**: `VITE_GEMINI_API_URL=https://generativelanguage.googleapis.com/v1beta`

## Vercel 部署配置

在 Vercel 部署时，需要在环境变量中添加：

```
VITE_DEEPSEEK_API_KEY = 你的DeepSeek_API_Key
VITE_DEEPSEEK_API_URL = https://api.deepseek.com/v1/chat/completions
VITE_DEEPSEEK_MODEL = deepseek-chat

VITE_GEMINI_API_KEY = 你的Gemini_API_Key
VITE_GEMINI_API_URL = https://for.shuo.bar/v1beta
VITE_GEMINI_MODEL = gemini-2.0-flash
VITE_ENABLE_GEMINI_DOCUMENT_PROCESSING = true
```

## 注意事项

1. **API Key 安全**: 永远不要将 API Key 提交到 Git 仓库
2. **文件大小**: Gemini API 限制单个文件最大 20MB
3. **支持格式**: 确认文件格式在支持列表中
4. **网络环境**: 使用官方 API 可能需要科学上网

## 更多帮助

如有问题，请查看：
- [Gemini API 官方文档](https://ai.google.dev/gemini-api/docs)
- [项目 README](./README.md)
- [部署指南](./DEPLOYMENT.md)
